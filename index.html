<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ç‰›é©¬å€’è®¡æ—¶ Â· å¼¹å¹•è”æœºç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
    margin:0;
    height:100%;
    background:#1f1f1f;
    font-family:"Microsoft YaHei",sans-serif;
    overflow:hidden;
}
.wrap{
    position:relative;
    z-index:2;
    height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    color:#e6e6e6;
}
h1{letter-spacing:3px;margin-bottom:4px}
.subtitle{font-size:13px;color:#aaa;margin-bottom:18px}
.time{font-size:40px;font-weight:bold}
.desc{margin-top:8px;font-size:15px;color:#999}

/* æ‹‰ç£¨ */
.mill-area{position:relative;width:320px;height:320px;margin-top:26px}
.mill{
    position:absolute;
    left:50%;top:50%;
    width:190px;height:190px;
    margin:-95px;
    border-radius:50%;
    border:6px dashed #555;
}
.animal{
    position:absolute;
    left:50%;top:50%;
    width:58px;height:58px;
    margin:-29px;
    animation:walk 10s linear infinite;
    filter:grayscale(1);
}
@keyframes walk{
    from{transform:rotate(0deg) translateX(150px)}
    to{transform:rotate(360deg) translateX(150px)}
}

/* å¼¹å¹• */
.bubble{
    position:absolute;
    white-space:nowrap;
    color:#aaa;
    font-size:14px;
    z-index:5;
}
@keyframes danmuMove{
    from{transform:translateX(0)}
    to{transform:translateX(-120vw)}
}

/* è¾“å…¥æ¡† */
.input-box{
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    z-index:99;
}
.input-box input{
    padding:8px;
    width:220px;
}
.input-box button{
    padding:8px;
}

/* ç°å°˜ */
canvas#dust{
    position:absolute;
    left:0;top:0;
    width:100%;height:100%;
    z-index:1;
}
</style>
</head>

<body>

<div class="wrap">
    <h1>ğŸ‚ ç‰›é©¬å€’è®¡æ—¶</h1>
    <div class="subtitle">åŠªåŠ›ä¸ä¸€å®šæœ‰ç»“æœï¼Œä½†ä¸€å®šå¾ˆç´¯</div>
    <div class="time" id="time">00 å¤© 00:00:00</div>
    <div class="desc" id="desc">ä»Šå¤©ä¹Ÿåœ¨æ­£å¸¸è¿è½¬</div>

    <div class="mill-area">
        <div class="mill"></div>
        <svg class="animal" viewBox="0 0 100 100">
            <g fill="#666">
                <ellipse cx="50" cy="55" rx="26" ry="18"/>
                <circle cx="78" cy="50" r="6"/>
                <rect x="20" y="68" width="6" height="18"/>
                <rect x="36" y="68" width="6" height="18"/>
                <rect x="56" y="68" width="6" height="18"/>
                <rect x="72" y="68" width="6" height="18"/>
            </g>
        </svg>
    </div>
</div>

<div class="input-box">
    <input id="danmuInput" placeholder="å‘ä¸€å¥ç‰›é©¬å®£è¨€â€¦">
    <button onclick="sendDanmu()">å‘å°„</button>
</div>

<canvas id="dust"></canvas>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/******** Firebase é…ç½®ï¼ˆâš ï¸ å¿…é¡»æ¢æˆä½ è‡ªå·±çš„ï¼‰ ********/
const firebaseConfig = {
  apiKey: "AIzaSyBdI1mZKLPuJ6YQk2zkSGRErxJszcLFdl4",
  authDomain: "cow-horse-danmu1.firebaseapp.com",
  databaseURL: "https://cow-horse-danmu1-default-rtdb.firebaseio.com",
  projectId: "cow-horse-danmu1",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const danmuRef = db.ref("danmu");
const ONE_HOUR = 60 * 60 * 1000;
    
/******** å€’è®¡æ—¶ ********/
const targetDate = new Date("2026-02-12T18:15:00");
function update(){
    const now = new Date();
    let diff = targetDate - now;
    if(diff <= 0){
        time.innerText="å·²å®Œæˆå½“å‰ä»»åŠ¡";
        desc.innerText="æ˜å¤©ç»§ç»­";
        return;
    }
    const d=Math.floor(diff/86400000);
    const h=Math.floor(diff/3600000)%24;
    const m=Math.floor(diff/60000)%60;
    const s=Math.floor(diff/1000)%60;
    time.innerText = `${d} å¤© ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}
setInterval(update,1000);update();

/******** å‘é€å¼¹å¹• ********/
function sendDanmu(){
    const input=document.getElementById('danmuInput');
    if(!input.value.trim()) return;
    danmuRef.push({
        text: input.value,
        time: Date.now()
    });
    input.value="";
}

/******** æ¥æ”¶å¼¹å¹• ********/
const ONE_HOUR = 60 * 60 * 1000;
const now = Date.now();

/* 1ï¸âƒ£ å…ˆè¯»å–è¿‡å» 1 å°æ—¶çš„å†å²å¼¹å¹• */
danmuRef.once("value", snapshot => {
    snapshot.forEach(child => {
        const data = child.val();
        if (now - data.time <= ONE_HOUR) {
            spawnDanmu(data.text);
        }
    });
});

/* 2ï¸âƒ£ å†ç›‘å¬æ–°çš„å¼¹å¹•ï¼ˆå®æ—¶ï¼‰ */
danmuRef.on("child_added", snap => {
    const data = snap.val();
    if (Date.now() - data.time <= ONE_HOUR) {
        spawnDanmu(data.text);
    }
});


/******** å¼¹å¹•åŠ¨ç”» ********/
function spawnDanmu(text){
    const t=document.createElement('div');
    t.className='bubble';
    t.innerText=text;
    t.style.top=Math.random()*60+20+'%';
    t.style.left='100%';
    t.style.animation='danmuMove 20s linear forwards';
    document.body.appendChild(t);
    setTimeout(()=>t.remove(),8000);
}

/******** ç°å°˜ ********/
const c=document.getElementById('dust');
const ctx=c.getContext('2d');
c.width=innerWidth;c.height=innerHeight;
let dusts=[];
for(let i=0;i<120;i++){
    dusts.push({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*2+0.5,v:Math.random()*0.3});
}
function animate(){
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle='rgba(180,180,180,0.25)';
    dusts.forEach(p=>{
        p.x+=p.v;if(p.x>c.width)p.x=0;
        ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
    });
    requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>

